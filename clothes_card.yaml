button_card_templates:
  clothes_card:
    show_name: false
    show_label: true
    variables:
      # üëá HIT SKA DU TITTA üëá
      # H√§r anger du dina egna sensorer.
      weather_entity: weather.home
      temp_entity: sensor.outdoor_temperature
      uv_entity: sensor.uv_index
      wind_entity: sensor.wind_speed
      rain_entity: sensor.rain_day   # byt till din egen regnsensor, t.ex. sensor.kronholmsgrand_nederbord_idag
      season_entity: sensor.season

    label: |
      [[[
        const weather = states[variables.weather_entity]?.state || "unknown";
        const temp = parseFloat(states[variables.temp_entity]?.state) || 0;
        const uv = parseFloat(states[variables.uv_entity]?.state) || 0;
        const wind = parseFloat(states[variables.wind_entity]?.state) || 0;
        const rain = parseFloat(states[variables.rain_entity]?.state) || 0;
        const season = states[variables.season_entity]?.state || "ok√§nd";

        let clothes = [];

        function capFirst(str) {
          return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // --- JACKOR / BYXOR / SKOR ---
        if (weather.includes("snow") || temp < -1) {
          clothes.push("Vinterjacka","Termobyxor","K√§ngor");
          if (temp < -1) clothes.push("Halsduk");
        } else if (temp <= 2) {
          clothes.push("Skaljacka","Fleece","Skalbyxor","Funktionsskor");
        } else if (temp <= 8) {
          clothes.push("Skaljacka","Skalbyxor","Funktionsskor");
        } else if (temp <= 15) {
          clothes.push("Skaljacka","Funktionsskor");
        } else if (temp <= 18) {
          clothes.push("Fleece","Sneakers");
        } else {
          clothes.push("Skaljacka","Sneakers");
        }

        // --- M√ñSSA ---
        if (temp <= -1) {
          clothes.push("Vinterm√∂ssa");
        } else if (temp <= 10 || (temp <= 12 && wind > 6)) {
          clothes.push("Tunn m√∂ssa");
        }

        // --- VANTAR ---
        if (temp <= -1) {
          clothes.push("Vintervantar");
        } else if (temp <= 8) {
          clothes.push("Tunna vantar");
        }

        // --- HALSDUK ---
        if (temp <= -1 || (temp <= 5 && wind > 6)) {
          if (!clothes.includes("Halsduk")) clothes.push("Halsduk");
        }

        // --- ST√ñVLAR ---
        if (weather.includes("rain") || rain >= 3) {
          if (!clothes.includes("St√∂vlar")) clothes.push("St√∂vlar");
        }

        // --- UV / SOL ---
        if ((season == "sommar" || season == "var") && uv > 2) {
          clothes.push("Keps","Solglas");
        }
        if ((season == "host" || season == "vinter") && uv > 4) {
          clothes.push("Solglas");
        }

        // --- PRIO ORDNING ---
        const priority = ["K√§ngor","St√∂vlar","Funktionsskor","Sneakers",
                          "Vinterjacka","Regnjacka","Skaljacka","Fleece",
                          "Termobyxor","Regnbyxor","Skalbyxor",
                          "Vinterm√∂ssa","Tunn m√∂ssa",
                          "Vintervantar","Tunna vantar",
                          "Halsduk","Keps","Solglas"];

        clothes = clothes.sort((a,b) => priority.indexOf(a) - priority.indexOf(b));

        // --- MAX 5 ---
        clothes = clothes.slice(0,5);

        return clothes.map(c => capFirst(c)).join(", ");
      ]]]
    custom_fields:
      title: "Rekommenderad kl√§dsel:"
      icons: |
        [[[
          const weather = states[variables.weather_entity]?.state || "unknown";
          const temp = parseFloat(states[variables.temp_entity]?.state) || 0;
          const uv = parseFloat(states[variables.uv_entity]?.state) || 0;
          const wind = parseFloat(states[variables.wind_entity]?.state) || 0;
          const rain = parseFloat(states[variables.rain_entity]?.state) || 0;
          const season = states[variables.season_entity]?.state || "ok√§nd";

          let clothes = [];

          if (weather.includes("snow") || temp < -1) {
            clothes.push("vinterjacka","termobyxor","kangor");
            if (temp < -1) clothes.push("halsduk");
          } else if (temp <= 2) {
            clothes.push("skaljacka","fleece","skalbyxor","hostsko");
          } else if (temp <= 8) {
            clothes.push("skaljacka","skalbyxor","hostsko");
          } else if (temp <= 15) {
            clothes.push("skaljacka","hostsko");
          } else if (temp <= 18) {
            clothes.push("fleece","sneakers");
          } else {
            clothes.push("skaljacka","sneakers");
          }

          // M√∂ssa
          if (temp <= -1) {
            clothes.push("vintermossa");
          } else if (temp <= 10 || (temp <= 12 && wind > 6)) {
            clothes.push("mossa");
          }

          // Vantar
          if (temp <= -1) {
            clothes.push("vintervantar");
          } else if (temp <= 8) {
            clothes.push("vantar");
          }

          if (temp <= -1 || (temp <= 5 && wind > 6)) {
            if (!clothes.includes("halsduk")) clothes.push("halsduk");
          }

          if (weather.includes("rain") || rain >= 3) {
            if (!clothes.includes("stovlar")) clothes.push("stovlar");
          }

          if ((season == "sommar" || season == "var") && uv > 2) {
            clothes.push("keps","solglas");
          }
          if ((season == "host" || season == "vinter") && uv > 4) {
            clothes.push("solglas");
          }

          const priority = ["kangor","stovlar","hostsko","sneakers",
                            "vinterjacka","regnjacka","skaljacka","fleece",
                            "termobyxor","regnbyxor","skalbyxor",
                            "vintermossa","mossa",
                            "vintervantar","vantar",
                            "halsduk","keps","solglas"];

          clothes = clothes.sort((a,b) => priority.indexOf(a) - priority.indexOf(b));
          clothes = clothes.slice(0,5);

          const base = "/local/pics/clothes/";
          return `<div style="display:flex;flex-wrap:wrap;justify-content:center;gap:6px;">
            ${clothes.map(c => `<img src='${base}${c}.png' style="height:75px;width:auto;filter: drop-shadow(0 0 3px white);">`).join("")}
          </div>`;
        ]]]
      note: Men kika g√§rna prognosen f√∂r resten av dagen ocks√•
    styles:
      grid:
        - grid-template-areas: '"title" "icons" "l" "note"'
        - grid-template-rows: auto auto auto auto
        - grid-template-columns: 1fr
      custom_fields:
        title:
          - justify-self: center
          - font-size: 16px
          - font-weight: bold
          - margin-top: 4px
          - margin-bottom: 2px
        icons:
          - justify-self: center
          - margin-bottom: 2px
        note:
          - font-size: 11px
          - color: gray
          - text-align: center
          - margin-bottom: 4px
      card:
        - height: 180px
        - padding: 4px
        - display: flex
        - flex-direction: column
        - justify-content: space-between
      label:
        - font-size: 13px
        - text-align: center
        - white-space: normal
        - margin-bottom: 2px
