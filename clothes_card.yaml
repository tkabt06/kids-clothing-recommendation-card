button_card_templates:
  clothes_card:
    show_name: false
    show_label: true
    variables:
      weather_entity: weather.home
      temp_entity: sensor.outdoor_temperature
      uv_entity: sensor.uv_index
      wind_entity: sensor.wind_speed
      rain_entity: sensor.rain_day  # byt mot din egen regnmätare
      season_entity: sensor.season

    label: |
      [[[
        const weather = states[variables.weather_entity]?.state || "unknown";
        const temp = parseFloat(states[variables.temp_entity]?.state) || 0;
        const uv = parseFloat(states[variables.uv_entity]?.state) || 0;
        const wind = parseFloat(states[variables.wind_entity]?.state) || 0;
        const rain = parseFloat(states[variables.rain_entity]?.state) || 0;
        const season = states[variables.season_entity]?.state || "okänd";

        let clothes = [];

        function capFirst(str) {
          return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // --- JACKOR / BYXOR ---
        if (weather.includes("snow") || temp < -1) {
          clothes.push("Vinterjacka","Termobyxor");
          if (temp < -1) clothes.push("Halsduk");
        } else if (temp <= 2) {
          clothes.push("Skaljacka","Fleece","Skalbyxor");
        } else if (temp <= 8) {
          clothes.push("Skaljacka","Skalbyxor");
        } else if (temp <= 15) {
          clothes.push("Skaljacka");
        } else if (temp <= 18) {
          clothes.push("Fleece");
        } else {
          clothes.push("Skaljacka");
        }

        // --- SKOR ---
        let shoes = null;
        if (weather.includes("rain") || rain >= 3) {
          shoes = "Stövlar";
        } else if (temp < -1) {
          shoes = "Kängor";
        } else if (temp <= 15) {
          shoes = "Funktionsskor";
        } else {
          shoes = "Sneakers";
        }
        if (shoes) clothes.push(shoes);

        // --- MÖSSA ---
        if (temp <= -1) {
          clothes.push("Vintermössa");
        } else if (temp <= 10 || (temp <= 12 && wind > 6)) {
          clothes.push("Mössa");
        }

        // --- HANDSKAR / VANTAR ---
        if (temp <= -1) {
          clothes.push("Handskar");
        } else if (temp <= 8) {
          clothes.push("Vantar");
        }

        // --- HALSDUK ---
        if (temp <= -1 || (temp <= 5 && wind > 6)) {
          if (!clothes.includes("Halsduk")) clothes.push("Halsduk");
        }

        // --- UV / SOL ---
        if ((season == "sommar" || season == "var") && uv > 2) {
          clothes.push("Keps","Solglas");
        }
        if ((season == "host" || season == "vinter") && uv > 4) {
          clothes.push("Solglas");
        }

        // --- PRIO ---
        const priority = ["Kängor","Stövlar","Funktionsskor","Sneakers",
                          "Vinterjacka","Regnjacka","Skaljacka","Fleece",
                          "Termobyxor","Regnbyxor","Skalbyxor",
                          "Vintermössa","Mössa",
                          "Handskar","Vantar",
                          "Halsduk","Keps","Solglas"];

        clothes = clothes.sort((a,b) => priority.indexOf(a) - priority.indexOf(b));
        clothes = clothes.slice(0,5);

        return clothes.map(c => capFirst(c)).join(", ");
      ]]]
    custom_fields:
      title: "Rekommenderad klädsel:"
      icons: |
        [[[
          const weather = states[variables.weather_entity]?.state || "unknown";
          const temp = parseFloat(states[variables.temp_entity]?.state) || 0;
          const uv = parseFloat(states[variables.uv_entity]?.state) || 0;
          const wind = parseFloat(states[variables.wind_entity]?.state) || 0;
          const rain = parseFloat(states[variables.rain_entity]?.state) || 0;
          const season = states[variables.season_entity]?.state || "okänd";

          let clothes = [];

          if (weather.includes("snow") || temp < -1) {
            clothes.push("vinterjacka","termobyxor");
            if (temp < -1) clothes.push("halsduk");
          } else if (temp <= 2) {
            clothes.push("skaljacka","fleece","skalbyxor");
          } else if (temp <= 8) {
            clothes.push("skaljacka","skalbyxor");
          } else if (temp <= 15) {
            clothes.push("skaljacka");
          } else if (temp <= 18) {
            clothes.push("fleece");
          } else {
            clothes.push("skaljacka");
          }

          let shoes = null;
          if (weather.includes("rain") || rain >= 3) {
            shoes = "stovlar";
          } else if (temp < -1) {
            shoes = "kangor";
          } else if (temp <= 15) {
            shoes = "hostsko";
          } else {
            shoes = "sneakers";
          }
          if (shoes) clothes.push(shoes);

          if (temp <= -1) {
            clothes.push("vintermossa");
          } else if (temp <= 10 || (temp <= 12 && wind > 6)) {
            clothes.push("mossa");
          }

          if (temp <= -1) {
            clothes.push("handskar");
          } else if (temp <= 8) {
            clothes.push("vantar");
          }

          if (temp <= -1 || (temp <= 5 && wind > 6)) {
            if (!clothes.includes("halsduk")) clothes.push("halsduk");
          }

          if ((season == "sommar" || season == "var") && uv > 2) {
            clothes.push("keps","solglas");
          }
          if ((season == "host" || season == "vinter") && uv > 4) {
            clothes.push("solglas");
          }

          const priority = ["kangor","stovlar","hostsko","sneakers",
                            "vinterjacka","regnjacka","skaljacka","fleece",
                            "termobyxor","regnbyxor","skalbyxor",
                            "vintermossa","mossa",
                            "handskar","vantar",
                            "halsduk","keps","solglas"];

          clothes = clothes.sort((a,b) => priority.indexOf(a) - priority.indexOf(b));
          clothes = clothes.slice(0,5);

          const base = "/local/pics/clothes/";
          return `<div style="display:flex;flex-wrap:wrap;justify-content:center;gap:6px;">
            ${clothes.map(c => `<img src='${base}${c}.png' style="height:75px;width:auto;filter: drop-shadow(0 0 3px white);">`).join("")}
          </div>`;
        ]]]
      note: Men kika gärna prognosen för resten av dagen också
    styles:
      grid:
        - grid-template-areas: '"title" "icons" "l" "note"'
        - grid-template-rows: auto auto auto auto
        - grid-template-columns: 1fr
      custom_fields:
        title:
          - justify-self: center
          - font-size: 16px
          - font-weight: bold
          - margin-top: 4px
          - margin-bottom: 2px
        icons:
          - justify-self: center
          - margin-bottom: 2px
        note:
          - font-size: 11px
          - color: gray
          - text-align: center
          - margin-bottom: 4px
      card:
        - height: 180px
        - padding: 4px
        - display: flex
        - flex-direction: column
        - justify-content: space-between
      label:
        - font-size: 13px
        - text-align: center
        - white-space: normal
        - margin-bottom: 2px
